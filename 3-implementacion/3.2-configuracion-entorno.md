# GuÃ­a de InicializaciÃ³n del Proyecto SIREDECI

## Vue.js + Vite + Django + PostgreSQL

## Prerrequisitos

Antes de comenzar, asegÃºrate de tener instalado:

- **Node.js** (v18 o superior): https://nodejs.org/
- **Python** (v3.10 o superior): https://www.python.org/
- **PostgreSQL** (v14 o superior): https://www.postgresql.org/
- **Git**: https://git-scm.com/

Verificar instalaciones:

```bash
node --version
npm --version
python --version
pip --version
psql --version
git --version
```

---

## Crear Proyecto Frontend (Vue.js + Vite)

### Crear carpeta del proyecto principal

```bash
# Crear carpeta raÃ­z del proyecto
mkdir siredeci
cd siredeci
```

### Inicializar proyecto Vue.js con Vite

```bash
# Crear proyecto Vue.js
npm create vite@latest frontend -- --template vue

# Navegar a la carpeta
cd frontend

# Instalar dependencias base
npm install
```

### Instalar dependencias adicionales

```bash
# Vue Router (navegaciÃ³n)
npm install vue-router@4

# Pinia (state management)
npm install pinia

# Axios (peticiones HTTP)
npm install axios

# Vuetify (componentes UI)
npm install vuetify@^3.3.0
npm install @mdi/font

# Vuelidate o VeeValidate (validaciÃ³n de formularios)
npm install @vuelidate/core @vuelidate/validators
# O alternativamente:
# npm install vee-validate yup

# Leaflet (mapas)
npm install leaflet vue3-leaflet
npm install @types/leaflet -D

# Chart.js (grÃ¡ficos)
npm install chart.js vue-chartjs

# Date utilities
npm install date-fns

# JWT decode
npm install jwt-decode

# SweetAlert2 (alertas bonitas)
npm install sweetalert2

# Variables de entorno
npm install dotenv
```

### Instalar dependencias de desarrollo

```bash
# ESLint (linting)
npm install -D eslint eslint-plugin-vue

# Prettier (formateo de cÃ³digo)
npm install -D prettier eslint-config-prettier eslint-plugin-prettier

# Sass (preprocesador CSS)
npm install -D sass
```

### Probar el proyecto

```bash
# Ejecutar en modo desarrollo
npm run dev

# Abrir navegador en: http://localhost:3000
```

---

## Crear Proyecto Backend (Django)

### Volver a la carpeta raÃ­z

```bash
cd ..
# DeberÃ­as estar en: siredeci/
```

### Crear entorno virtual de Python

```bash
# Crear entorno virtual
python -m venv venv

# Activar entorno virtual
# En Windows:
venv\Scripts\activate
# En Linux/Mac:
source venv/bin/activate

# Verificar que estÃ¡s en el entorno virtual
which python  # Linux/Mac
where python  # Windows
```

### Crear carpeta backend

```bash
mkdir backend
cd backend
```

### Instalar Django y dependencias base

```bash
# Actualizar pip
pip install --upgrade pip

# Django core
pip install Django==4.2.7

# Django REST Framework
pip install djangorestframework==3.14.0

# PostgreSQL adapter
pip install psycopg2-binary==2.9.9

# CORS headers
pip install django-cors-headers==4.3.0

# JWT Authentication
pip install djangorestframework-simplejwt==5.3.0

# Environment variables
pip install python-decouple==3.8

# Django extensions
pip install django-extensions==3.2.3

# Filtering
pip install django-filter==23.4
```

### Instalar dependencias adicionales

```bash
# Image processing
pip install Pillow==10.1.0

# File storage
pip install django-storages==1.14.2
pip install boto3==1.29.7

# Celery (tasks asÃ­ncronas)
pip install celery==5.3.4
pip install redis==5.0.1
pip install django-celery-beat==2.5.0

# API Documentation
pip install drf-yasg==1.21.7

# Testing
pip install pytest==7.4.3
pip install pytest-django==4.7.0
pip install factory-boy==3.3.0

# Production server
pip install gunicorn==21.2.0
pip install whitenoise==6.6.0
```

### Crear requirements.txt

```bash
pip freeze > requirements.txt
```

### Inicializar proyecto Django

```bash
# Crear proyecto Django
django-admin startproject config .

# Verificar estructura
ls -la
# DeberÃ­as ver: config/, manage.py, requirements.txt
```

### Crear estructura de apps

```bash
# Crear carpeta apps
mkdir apps
mkdir apps/__init__.py

# Crear apps del proyecto
python manage.py startapp usuarios apps/usuarios
python manage.py startapp ciudadanos apps/ciudadanos
python manage.py startapp denuncias apps/denuncias
python manage.py startapp personal apps/personal
python manage.py startapp notificaciones apps/notificaciones
python manage.py startapp reportes apps/reportes
python manage.py startapp categorias apps/categorias
```

### Paso 9: Crear carpeta core

```bash
mkdir core
mkdir core/__init__.py
```

### Paso 10: Crear archivo .env

```bash
cat > .env << 'EOF'
# Django
SECRET_KEY=django-insecure-change-this-in-production-2025
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# Database
DB_NAME=siredeci_db
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=localhost
DB_PORT=5432

# CORS
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# JWT
JWT_ACCESS_TOKEN_LIFETIME=60
JWT_REFRESH_TOKEN_LIFETIME=1440

# Email (para desarrollo)
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your_email@gmail.com
EMAIL_HOST_PASSWORD=your_password

# Redis
REDIS_URL=redis://localhost:6379/0

# AWS S3 (opcional)
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key
AWS_STORAGE_BUCKET_NAME=siredeci-bucket
AWS_S3_REGION_NAME=us-east-1
EOF
```

### Paso 11: Crear .gitignore para backend

```bash
cat > .gitignore << 'EOF'
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# Django
*.log
local_settings.py
db.sqlite3
db.sqlite3-journal
/media
/static

# Environment
.env
.venv
venv/
ENV/
env/

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db
EOF
```

### Paso 12: Configurar settings.py bÃ¡sico

```bash
# Navegar a config/
cd config

# Crear carpeta settings
mkdir settings
touch settings/__init__.py

# Mover settings.py a settings/base.py
mv settings.py settings/base.py
```

**Editar `config/settings/base.py`** (hacer manualmente o con editor):

```python
# Agregar al inicio:
from pathlib import Path
from decouple import config
import os

BASE_DIR = Path(__file__).resolve().parent.parent.parent

# Cambiar SECRET_KEY:
SECRET_KEY = config('SECRET_KEY')

# Cambiar DEBUG:
DEBUG = config('DEBUG', default=False, cast=bool)

# Cambiar ALLOWED_HOSTS:
ALLOWED_HOSTS = config('ALLOWED_HOSTS', default='').split(',')

# En INSTALLED_APPS agregar:
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Third party apps
    'rest_framework',
    'rest_framework_simplejwt',
    'corsheaders',
    'django_filters',
    'drf_yasg',
    
    # Local apps
    'apps.usuarios',
    'apps.ciudadanos',
    'apps.denuncias',
    'apps.personal',
    'apps.notificaciones',
    'apps.reportes',
    'apps.categorias',
]

# En MIDDLEWARE agregar CORS:
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'corsheaders.middleware.CorsMiddleware',  # Agregar esto
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

# Configurar base de datos:
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': config('DB_NAME'),
        'USER': config('DB_USER'),
        'PASSWORD': config('DB_PASSWORD'),
        'HOST': config('DB_HOST'),
        'PORT': config('DB_PORT', default='5432'),
    }
}

# Al final del archivo agregar:

# Django REST Framework
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ),
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 20,
    'DEFAULT_FILTER_BACKENDS': [
        'django_filters.rest_framework.DjangoFilterBackend',
        'rest_framework.filters.SearchFilter',
        'rest_framework.filters.OrderingFilter',
    ],
}

# CORS
CORS_ALLOWED_ORIGINS = config('CORS_ALLOWED_ORIGINS', default='').split(',')
CORS_ALLOW_CREDENTIALS = True

# JWT Settings
from datetime import timedelta
SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(minutes=config('JWT_ACCESS_TOKEN_LIFETIME', default=60, cast=int)),
    'REFRESH_TOKEN_LIFETIME': timedelta(minutes=config('JWT_REFRESH_TOKEN_LIFETIME', default=1440, cast=int)),
    'ROTATE_REFRESH_TOKENS': True,
    'BLACKLIST_AFTER_ROTATION': True,
}

# Media files
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

# Static files
STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
```

### Paso 13: Crear settings de desarrollo y producciÃ³n

**Crear `config/settings/development.py`:**

```bash
cat > settings/development.py << 'EOF'
from .base import *

DEBUG = True

ALLOWED_HOSTS = ['localhost', '127.0.0.1']

# Database con nombre diferente para desarrollo
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'siredeci_dev',
        'USER': config('DB_USER'),
        'PASSWORD': config('DB_PASSWORD'),
        'HOST': config('DB_HOST'),
        'PORT': config('DB_PORT'),
    }
}

# Email backend para consola
EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'
EOF
```

**Crear `config/settings/production.py`:**

```bash
cat > settings/production.py << 'EOF'
from .base import *

DEBUG = False

ALLOWED_HOSTS = config('ALLOWED_HOSTS', default='').split(',')

# Security settings
SECURE_SSL_REDIRECT = True
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True
SECURE_BROWSER_XSS_FILTER = True
SECURE_CONTENT_TYPE_NOSNIFF = True
X_FRAME_OPTIONS = 'DENY'

# ConfiguraciÃ³n de email real (ejemplo con Gmail)
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = config('EMAIL_HOST')
EMAIL_PORT = config('EMAIL_PORT', cast=int)
EMAIL_USE_TLS = True
EMAIL_HOST_USER = config('EMAIL_HOST_USER')
EMAIL_HOST_PASSWORD = config('EMAIL_HOST_PASSWORD')
EOF
```

**Crear `config/settings/__init__.py`:**

```bash
cat > settings/__init__.py << 'EOF'
from .base import *

# Importar configuraciÃ³n segÃºn entorno
import os

environment = os.getenv('DJANGO_ENV', 'development')

if environment == 'production':
    from .production import *
else:
    from .development import *
EOF
```

### Paso 14: Volver al directorio backend

```bash
cd ..
# DeberÃ­as estar en: siredeci/backend/
```

---

## ðŸ—„ï¸ PARTE 3: Configurar PostgreSQL

### Paso 1: Iniciar PostgreSQL

```bash
# Iniciar servicio PostgreSQL
# En Linux:
sudo systemctl start postgresql
# En Mac:
brew services start postgresql
# En Windows (si se instalÃ³ como servicio):
# Se inicia automÃ¡ticamente o desde Services
```

### Paso 2: Acceder a PostgreSQL

```bash
# Acceder como superusuario postgres
sudo -u postgres psql
# O en Windows:
psql -U postgres
```

### Paso 3: Crear base de datos y usuario

```sql
-- Crear base de datos
CREATE DATABASE siredeci_db;

-- Crear usuario
CREATE USER siredeci_user WITH PASSWORD 'siredeci2025';

-- Dar privilegios
ALTER ROLE siredeci_user SET client_encoding TO 'utf8';
ALTER ROLE siredeci_user SET default_transaction_isolation TO 'read committed';
ALTER ROLE siredeci_user SET timezone TO 'America/Lima';

GRANT ALL PRIVILEGES ON DATABASE siredeci_db TO siredeci_user;

-- Dar permisos de creaciÃ³n de tablas
\c siredeci_db
GRANT ALL ON SCHEMA public TO siredeci_user;

-- Crear esquema siredeci
CREATE SCHEMA IF NOT EXISTS siredeci;
GRANT ALL ON SCHEMA siredeci TO siredeci_user;

-- Salir
\q
```

### Paso 4: Verificar conexiÃ³n

```bash
# Probar conexiÃ³n desde la terminal
psql -U siredeci_user -d siredeci_db -h localhost

# Si funciona, salir con:
\q
```

### Paso 5: Actualizar .env con las credenciales

```bash
# Editar backend/.env con las credenciales correctas:
DB_NAME=siredeci_db
DB_USER=siredeci_user
DB_PASSWORD=siredeci2025
DB_HOST=localhost
DB_PORT=5432
```

---

## ðŸš€ PARTE 4: Ejecutar Migraciones y Crear Superusuario

### Paso 1: Verificar que estÃ¡s en el entorno virtual

```bash
# DeberÃ­as estar en: siredeci/backend/
# Verificar entorno virtual activo
which python  # Linux/Mac
where python  # Windows

# Si no estÃ¡ activo, activar:
source ../venv/bin/activate  # Linux/Mac
..\venv\Scripts\activate     # Windows
```

### Paso 2: Verificar configuraciÃ³n de Django

```bash
# Probar configuraciÃ³n
python manage.py check

# DeberÃ­a responder: System check identified no issues (0 silenced).
```

### Paso 3: Crear migraciones iniciales

```bash
# Crear migraciones
python manage.py makemigrations

# Ejecutar migraciones
python manage.py migrate
```

### Paso 4: Crear superusuario

```bash
python manage.py createsuperuser

# Te pedirÃ¡:
# Username: admin
# Email: admin@siredeci.gob.pe
# Password: (crear una contraseÃ±a segura)
# Password (again): (repetir)
```

### Paso 5: Ejecutar el script de creaciÃ³n de tablas

```bash
# Copiar el script SQL a una ubicaciÃ³n accesible
# Luego ejecutarlo:
psql -U siredeci_user -d siredeci_db -f crear-base-datos-siredeci.sql
```

### Paso 6: Ejecutar el script de poblamiento

```bash
psql -U siredeci_user -d siredeci_db -f poblamiento-inicial-siredeci.sql
```

---

## â–¶ï¸ PARTE 5: Ejecutar Ambos Proyectos

### Terminal 1: Ejecutar Backend (Django)

```bash
# Navegar a backend
cd siredeci/backend

# Activar entorno virtual
source ../venv/bin/activate  # Linux/Mac
..\venv\Scripts\activate     # Windows

# Ejecutar servidor
python manage.py runserver

# El servidor estarÃ¡ en: http://localhost:8000
```

### Terminal 2: Ejecutar Frontend (Vue.js)

```bash
# Abrir nueva terminal
# Navegar a frontend
cd siredeci/frontend

# Ejecutar servidor de desarrollo
npm run dev

# El servidor estarÃ¡ en: http://localhost:3000
```

### Verificar que todo funciona

**Backend:**
- Admin: http://localhost:8000/admin/
- API: http://localhost:8000/api/
- Swagger: http://localhost:8000/swagger/

**Frontend:**
- App: http://localhost:3000/

---

## ðŸ“¦ PARTE 6: Scripts Ãºtiles en package.json

**Agregar a `frontend/package.json`:**

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext .vue,.js,.jsx,.cjs,.mjs --fix --ignore-path .gitignore",
    "format": "prettier --write src/"
  }
}
```

---

## ðŸ”„ PARTE 7: ConfiguraciÃ³n de Git

### Paso 1: Inicializar repositorio

```bash
# En la raÃ­z del proyecto (siredeci/)
cd siredeci
git init
```

### Paso 2: Crear .gitignore principal

```bash
cat > .gitignore << 'EOF'
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
ENV/
env/

# Django
*.log
db.sqlite3
media/
staticfiles/

# Node
node_modules/
dist/
*.local

# Environment
.env
.env.local
.env.*.local

# IDE
.vscode/
.idea/
*.swp

# OS
.DS_Store
Thumbs.db
EOF
```

### Paso 3: Primer commit

```bash
git add .
git commit -m "Initial commit: Vue.js + Django + PostgreSQL setup"
```

---

## âœ… Checklist de VerificaciÃ³n

**Frontend (Vue.js):**
- [ ] Node.js instalado
- [ ] Proyecto Vue creado con Vite
- [ ] Dependencias instaladas
- [ ] Servidor corriendo en puerto 3000
- [ ] Variables de entorno configuradas

**Backend (Django):**
- [ ] Python instalado
- [ ] Entorno virtual creado y activado
- [ ] Django instalado
- [ ] Proyecto Django creado
- [ ] Apps creadas
- [ ] Variables de entorno configuradas
- [ ] Servidor corriendo en puerto 8000

**Base de Datos (PostgreSQL):**
- [ ] PostgreSQL instalado
- [ ] Base de datos creada
- [ ] Usuario creado
- [ ] Permisos otorgados
- [ ] Migraciones ejecutadas
- [ ] Superusuario creado
- [ ] Scripts SQL ejecutados

**IntegraciÃ³n:**
- [ ] CORS configurado
- [ ] Frontend puede hacer peticiones al backend
- [ ] AutenticaciÃ³n JWT funciona

---

## ðŸ†˜ SoluciÃ³n de Problemas Comunes

### Error: "Module not found"
```bash
# Frontend
npm install

# Backend
pip install -r requirements.txt
```

### Error: "Port already in use"
```bash
# Cambiar puerto en vite.config.js (frontend)
# O en python manage.py runserver 8001 (backend)
```

### Error: "Database connection failed"
```bash
# Verificar que PostgreSQL estÃ© corriendo
sudo systemctl status postgresql

# Verificar credenciales en .env
```

### Error: "CORS policy blocked"
```bash
# Verificar config/settings/base.py:
# CORS_ALLOWED_ORIGINS debe incluir http://localhost:3000
```

---

## ðŸŽ‰ Â¡Proyecto Inicializado!

Tu proyecto estÃ¡ listo. Estructura final:

```
siredeci/
â”œâ”€â”€ frontend/              # Vue.js + Vite
â”‚   â”œâ”€â”€ node_modules/
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ .env.development
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js
â”‚
â”œâ”€â”€ backend/               # Django
â”‚   â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ media/
â”‚   â”œâ”€â”€ .env
â”‚   â”œâ”€â”€ manage.py
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ venv/                  # Entorno virtual Python
â”‚
â””â”€â”€ .gitignore
```

**PrÃ³ximos pasos:**
1. Crear los modelos en Django (apps/*/models.py)
2. Crear los serializers (apps/*/serializers.py)
3. Crear las vistas/ViewSets (apps/*/views.py)
4. Configurar las rutas (apps/*/urls.py)
5. Crear componentes Vue.js (frontend/src/components/)
6. Crear servicios API (frontend/src/services/)
7. Configurar router Vue (frontend/src/router/)
8. Crear stores Pinia (frontend/src/stores/)

Â¡Feliz desarrollo! ðŸš€